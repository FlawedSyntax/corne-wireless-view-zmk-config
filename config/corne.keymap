/*
 * Copyright (c) 2020 The ZMK Contributors
 *
 * SPDX-License-Identifier: MIT
 */

#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
// #include <config/keys_de.h>

// custom defines here, because include doesn't work
#include <dt-bindings/zmk/hid_usage.h>
#include <dt-bindings/zmk/hid_usage_pages.h>
#include <dt-bindings/zmk/modifiers.h>

// keys/36.h from https://github.com/BerkeleyTrue/zmk-keyboards/blob/master/config/corne.keymap
#include "keys/36.h"

// shorter codes - also from BerkeleyTrue
#define ___     &trans // transparent
#define _x_     &none
#define BPSTE    &kp  K_PASTE
#define BCPY     &kp  K_COPY
#define BCUT     &kp  K_CUT
#define BUNDO    &kp  K_UNDO
#define BREDO    &kp  K_REDO
#define BPREV    &kp  K_PREV
#define BNEXT    &kp  K_NEXT
#define BPLYPSE  &kp  K_PP
#define BMUTE    &kp  K_MUTE
#define BSTOP    &kp  K_STOP2
#define BVOLD    &kp  K_VOL_DN
#define BVOLU    &kp  K_VOL_UP
#define OUTTOG   &out OUT_TOG // toggle keyboard output bluetooth/usb

&sk {
    release-after-ms = <2000>;
    quick-release;
    /delete-property/ ignore-modifiers;
};

// define 5 col keyboard layout
/ {
  chosen {
    zmk;matrix_transform = &five_column_transform;
  };
};

/ {
        combos  {
            compatible = "zmk,combos";
            combo_esc {
              timeout-ms = <50>;
              key-positions = <0 1>;
              // layers = <LOWER BASE RAISE>;
              bindings = <&kp ESC>; 
            };
            
            combo_bsp {
              timeout-ms = <50>;
              key-positions = <8 9>;
              // layers = <BASE LOWER RAISE>;
              bindings = <&kp BACKSPACE>; 
            };
            
            combo_tab {
              timeout-ms = <50>;
              key-positions = <10 11>;
              // layers = <BASE LOWER RAISE>;
              bindings = <&kp TAB>; 
            };
            
            combo_sft {
              timeout-ms = <50>;
              key-positions = <20 21>;
              // layers = <BASE LOWER RAISE>;
              bindings = <&kp LSFT>; 
            };
            
            combo_del {
              timeout-ms = <50>;
              key-positions = <18 19>;
              // layers = <LOWER RAISE BASE>;
              bindings = <&kp DEL>; 
            };
            
            combo_rsft {
              timeout-ms = <50>;
              key-positions = <28 29>;
              // layers = <LOWER BASE RAISE>;
              bindings = <&kp RSFT>; 
            };
            
            combo_home {
              timeout-ms = <50>;
              key-positions = <15 16>;
              // layers = <BASE LOWER RAISE>;
              bindings = <&kp HOME>; 
            };
            
            combo_end {
              timeout-ms = <50>;
              key-positions = <25 26>;
              // layers = <BASE LOWER RAISE>;
              bindings = <&kp END>; 
            };

            // combo_win {
            //       timeout-ms = <50>;
            //       key-positions = <38 39>;
            //       // layers = <BASE LOWER RAISE>;
            //       bindings = <&kp LGUI>; 
            //     };
            
            combo_navigation {
                  timeout-ms = <50>;
                  key-positions = <31 34>;
                  bindings = <&mo 3>;
            };

            combo_media {
                  timeout-ms = <50>;
                  key-positions = <30 34>;
                  bindings = <&mo 4>;
            };
        }; // end combos
}


// keymap
/ {
    keymap {
      compatible = "zmk,keymap";
      default_layer {
        display-name = "Base";
        bindings = <  
    // ╭─────────────────────────────────────────────────╮   ╭─────────────────────────────────────────────────╮
    // │    Q    │    W    │    E    │    R    │    T    │   │    Y    │    U    │    I    │    O    │    P    │
        &kp Q     &kp W     &kp E     &kp R     &kp T         &kp Y     &kp U     &kp I     &kp O     &kp P
    // ├─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┤
    // │    A    │    S    │    D    │    F    │    G    │   │    H    │    J    │    K    │    L    │    ;    │
        &kp A     &kp S     &kp D     &kp F     &kp G         &kp H     &kp J     &kp K     &kp L     &kp SEMI
    // ├─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┤
    // │    Z    │    X    │    C    │    V    │    B    │   │    N    │    M    │   ,     │   .     │    /    │
        &kp Z     &kp X     &kp C     &kp V     &kp B         &kp N     &kp M     &kp COMMA &kp DOT   &kp SLASH
    // ╰─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────╯
                            &kp LCTRL &mo 1     &kp RETURN    &kp SPACE &mo 2     &kp RALT
    //                     ╰─────────────────────────────╯   ╰─────────────────────────────╯
        >;
      };
      number_layer {
        display-name = "Number";
        bindings = <
    // ╭─────────────────────────────────────────────────╮   ╭─────────────────────────────────────────────────╮
    // │   F1    │   F2    │  F3     │   F4    │   F5    │   │   F6    │   F7    │   F8    │   F9    │   F10   │
        &kp F1    &kp F2    &kp F3    &kp F4    &kp F5        &kp F6    &kp F7    &kp F8   &kp F9     &kp F10
    // ├─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┤
    // │    1    │    2    │    3    │    4    │    5    │   │     6   │    7    │    8    │    9    │    0    │
        &kp N1    &kp N2    &kp N3    &kp N4    &kp N5        &kp N6    &kp N7    &kp N8    &kp N9    &kp N0
    // ├─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┤
    // │   F11   │   F12   │   NOP   │   NOP   │ TILDE   │   │  LBKT   │   RBKT  │   BSLH  │    -    │    =    │
        &kp F11   &kp F12     _x_       _x_     &kp TILDE      &kp LBKT  &kp RBKT &kp BSLH  &kp MINUS &kp EQUAL 
    // ╰─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────╯
    //                     │   NOP   │   NOP   │   NOP   │   │  SPACE  │   BSPC  │  ENTER  │
                              _x_      _x_       _x_         &kp SPACE &kp BSPC  &kp RET
    //                     ╰─────────────────────────────╯   ╰─────────────────────────────╯
      >;
    };
    navigation_layer { 
      display-name = "Navigation";
      bindings = <
    // ╭─────────────────────────────────────────────────╮   ╭─────────────────────────────────────────────────╮
    // │   NOP   │   NOP   │   NOP   │   NOP   │   NOP   │   │   NOP   │   CUT   │   UP    │  NOP    │  HOME   │
          _x_       _x_       _x_       _x_       _x_           _x_       BCUT    &kp UP      _x_     &kp HOME
    // ├─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┤
    // │ SHIFT   │  CTRL   │   ALT   │   SUPER │  TILDE  │   │ QUOTE   │  LEFT   │    UP   │  RIGHT  │   END   │
        &kp LSHFT &kp LCTRL  &kp LALT &kp LGUI  &kp TILDE     &kp SQT   &kp LEFT  &kp DOWN  &kp RIGHT &kp END
    // ├─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┤
    // │  UNDO   │   CUT   │   COPY  │  PASTE  │  REDO   │   │  NOP    │  PGDN   │   PGUP  │   NOP   │  INSERT │
          BUNDO      BCUT      BCPY     BPSTE     BREDO         _x_    &kp PG_DN &kp PG_UP    _x_     &kp INS
    // ╰─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────╯
    //                     │   NOP   │   NOP   │   NOP   │   │   NOP   │   NOP   │   NOP   │
                              _x_       _x_       _x_            _x_       _x_       _x_
    //                     ╰─────────────────────────────╯   ╰─────────────────────────────╯
      >;
    };
    media_layer {
      display-name = "Media";
      bindings = <
    // ╭─────────────────────────────────────────────────╮   ╭─────────────────────────────────────────────────╮
    // │BTPROF 0 │BTPROF 1 │BTPROF 2 │BTPROF 3 │BTROF 4  │   │   NOP   │   STOP  │ Pause   │  Mute   │   NOP   │
        &btsc_0   &btsc_1   &btsc_2   &btsc_3   &btsc_4         _x_       BSTOP    BPLYPSE    BMUTE      _x_
    // ├─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┤
    // │ SHIFT   │  CTRL   │   ALT   │   SUPER │   NOP   │   │   NOP   │PREV_TRCK│ VOl_DOWN│  VOL_UP │NEXT_TRCK│
        &kp LSHFT &kp LCTRL  &kp LALT &kp LGUI  _x_           OUTTOG    BPREV     BVOLD     BVOLU     BNEXT
    // ├─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┤
    // │   NOP   │   NOP   │   NOP   │   NOP   │   NOP   │   │   NOP   │   NOP   │   NOP   │   NOP   │   NOP   │
        _x_       _x_       _x_       &bt BT_CLR   _x_          _x_       _x_       _x_       _x_       _x_     
    // ╰─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────╯
    //                     │   NOP   │   NOP   │   NOP   │   │   NOP   │ NOP     │  NOP    │
                              ___       _x_       _x_            _x_      _x_      _x_
    //                     ╰─────────────────────────────╯   ╰─────────────────────────────╯
          >;
      
};
